<!DOCTYPE html>
<html>
<head>
    <title>Bookmap: voronoi diagram with Hilbert coords</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <link rel="stylesheet" href="style.css" />
    <script src="http://d3js.org/d3.v4.min.js"></script>
    <script src="booklist.js"></script>
    <script src="hilbert.js"></script> 
    <style type="text/css">
    </style>
</head>
<body>
<div id="chart">
</div>
<script type="text/javascript">

JITTER = 10;

function jitter(dewey) {
    return dewey + ( Math.random() - 0.5 ) * JITTER;
}

width = 640;


var books = BOOKS.map(function (b) {
    coords = hilbert(jitter(b.dd), 1000, 8, width);
    c = d3.hsl(360 * b.dd * 0.001, 1, 0.76).toString();
    return { "x": coords[0], "y": coords[1], "c": c, "title": b.title,"dewey": b.dd };
});




var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", width);


console.log("Number of books:", books.length);

var voronoi = d3.voronoi()
.extent([[-1, -1], [width + 1, width + 1]])
.x(function (d) {
console.log("voronoi access", d);
return d.x
} )
.y(function (d) { return d.y } );

var polygon = svg.append("g")
.attr("class", "polygons")
.selectAll("path")
.data(voronoi.polygons(books))
.enter()
  .append("path")
  .attr("class", "cell")
  .attr("d", function(d) { return d ? "M" + d.join("L") + "Z" : null; })
  .attr("fill", function(d) {
console.log("Fill poly", d);
return d ? ( d.data ? d.data.c : null ) : null;
});






</script>
</body>
</html>
